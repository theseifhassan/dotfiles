#!/bin/sh
# X init script
# Sources xprofile, loads Xresources, starts WM

# Load X resources
xrdb -merge "${XDG_CONFIG_HOME:-$HOME/.config}/x11/xresources"
[ -f "${XDG_CONFIG_HOME:-$HOME/.config}/x11/xresources.local" ] && xrdb -merge "${XDG_CONFIG_HOME:-$HOME/.config}/x11/xresources.local"

# Load X profile (autostart apps)
[ -f "${XDG_CONFIG_HOME:-$HOME/.config}/x11/xprofile" ] && . "${XDG_CONFIG_HOME:-$HOME/.config}/x11/xprofile"

# Keyring
if command -v gnome-keyring-daemon >/dev/null 2>&1; then
    eval $(/usr/bin/gnome-keyring-daemon --start --components=pkcs11,secrets,ssh)
    export SSH_AUTH_SOCK
fi

# DBus/systemd integration
command -v systemctl >/dev/null 2>&1 && systemctl --user import-environment DISPLAY XAUTHORITY
command -v dbus-update-activation-environment >/dev/null 2>&1 && dbus-update-activation-environment --systemd DISPLAY XAUTHORITY

# Start window manager
exec dwm
