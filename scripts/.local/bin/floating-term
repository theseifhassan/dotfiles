#!/bin/sh
# floating-term [cols] [rows] [cmd...]
cols="${1:-80}"
rows="${2:-24}"
shift 2 2>/dev/null

w=$((cols * 10))
h=$((rows * 20))

if [ $# -gt 0 ]; then
    ghostty --x11-instance-name=floating --gtk-single-instance=false -e "$@" &
else
    ghostty --x11-instance-name=floating --gtk-single-instance=false &
fi
pid=$!

# Wait for window to appear with timeout
wid=""
for _ in 1 2 3 4 5 6 7 8 9 10; do
    wid=$(xdotool search --pid "$pid" 2>/dev/null | head -1)
    [ -n "$wid" ] && break
    sleep 0.1
done
[ -n "$wid" ] && xdotool windowsize "$wid" "$w" "$h"
wait "$pid"
